<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8" />
		<title>组织结构定义</title>
		<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css" />
		<link rel="stylesheet" type="text/css" href="css/organization_structure.css" />
		<link rel="stylesheet" type="text/css" href="css/bootstrapStyle/bootstrapStyle.css"/>
	</head>

	<body>

		<div id="ctx">
			<div class="container-fluid">
				<div class="row">
					<div>
						<span>组织结构定义</span>
					</div>
					<div>
						<div style="float: right;box-sizing: border-box;padding-right: 100px;padding-top: 13px;">
							<input id="querybox" type="text" placeholder="匹配工号/姓名/手机" style="height: 35px;margin-right: 10px;width: 300px;outline:none;" />
							<button @click="check" class="btn btn-success" style="width: 100px;margin-right: 10px;">搜索</button>
							<button class="btn btn-default" style="width: 70px;">关闭</button>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-md-12 col-xs-12" style="box-sizing: border-box;background-color: #F7F7F7;border: 1px solid #E9E9E9;">
						<ul>
							<li class="btn-group" style="">
								<button  type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
								    机构部门编辑 <span class="caret"></span>
								</button>
								<ul class="dropdown-menu">
								    <li @click="addsamelevel"><a >增加同级</a></li>
								    <li @click="addsonlevel"><a>增加子级</a></li>
								    <li @click="upmechanism"><a>修改</a></li>
								    <li @click="delmechanism"><a>删除</a></li>
								 </ul>
							</li>
							<li @click="addstaff"><span class="glyphicon glyphicon-plus-sign"></span>增加员工</li>
							<li @click="upStaff"><span class="glyphicon glyphicon-leaf"></span>修改</li>
							<li @click="delStaff"><span class="glyphicon glyphicon-remove-sign"></span>删除</li>
							<li @click="nonepwd"><span class="glyphicon glyphicon-lock"></span>置空密码</li>
							<li><span class="glyphicon glyphicon-export"></span>导出</li>
							<li><span class="glyphicon glyphicon-import"></span>导入</li>
							<li @click="staffrole"><span class="glyphicon glyphicon-user"></span>员工角色</li>
							<li @click="setting"><span class="glyphicon glyphicon-cog"></span>字段设置</li>
						</ul>
					</div>
					<div class="col-md-2 col-xs-2" style="padding-top: 25px;">
						<ul id="treeDemo" class="ztree"></ul> 
					</div>
					<div class="col-md-10 col-xs-10" style="border-left: 1px solid #E9E9E9;">
						<table class="table table-bordered" style="width: 3000px;">
							<thead>
								<tr>
									<td> </td>
									<td>机构</td>
									<td>部门代码</td>
									<td>部门名称</td>
									<td>工号</td>
									<td>姓名</td>
									<td>性别</td>
									<td>岗位名称</td>
									<td>身体状况</td>
									<td>身高</td>
									<td>籍贯</td>
									<td>民族</td>
									<td>婚姻状况</td>
									<td>学历</td>
									<td>毕业学校</td>
									<td>专业</td>
									<td>专业资格</td>
									<td>身份证号</td>
									<td>户口地址</td>
									<td>邮编</td>
									<td>现住地址</td>
									<td>联系电话</td>
									<td>手机</td>
									<td>EMail</td>
									<td>紧急情况联系人</td>
									<td>联系电话</td>
									<td>试用到期</td>
									<td>入职日期</td>
									<td>出生日期</td>
									<td>合同开始日期</td>
									<td>合同结束日期</td>
								</tr>
							</thead>
							<tbody id="tb">
								<tr v-for="s,index in staffs" v-if="index==0" style="background-color:#C9E2B3 ;">
									<td v-if="index==0"><input checked="checked" type="radio" v-bind:id="s.pno" name="staff" @click="chosestaff($event,s)"  /> </td>
									<td v-else><input  type="radio" v-bind:id="s.pno" name="staff" @click="chosestaff($event,s)"  /> </td>
									<td v-for="m in mechanismPa" v-if="m.mid==s.parentid">{{m.mname}}</td>
									<td>{{s.mid}}</td>
									<td>{{s.mname}}</td>
									<td>{{s.pno}}</td>
									<td>{{s.pname}}</td>
									<td>{{s.psex}}</td>
									<td>{{s.jname}}</td>
									<td>{{s.shealth}}</td>
									<td>{{s.sheight}}</td>
									<td>{{s.splace}}</td>
									<td>{{s.snation}}</td>
									<td>{{s.smarry}}</td>
									<td>{{s.seducation}}</td>
									<td>{{s.sschool}}</td>
									<td>{{s.smajor}}</td>
									<td>{{s.smajorlevel}}</td>
									<td>{{s.pidcard}}</td>
									<td>{{s.presidenceaddress}}</td>
									<td>{{s.pemail}}</td>
									<td>{{s.paddress}}</td>
									<td>{{s.pphone}}</td>
									<td>{{s.ptellphone}}</td>
									<td>{{s.pemail}}</td>
									<td>{{s.speople}}</td>
									<td>{{s.speoplephone}}</td>
									<td>{{s.sinterniship}}</td>
									<td>{{s.sindate}}</td>
									<td>{{s.sbirthday}}</td>
									<td>{{s.sstarttime}}</td>
									<td>{{s.sendtime}}</td>
								</tr>
								<tr v-else>
									<td v-if="index==0"><input checked="checked" type="radio" v-bind:id="s.pno" name="staff" @click="chosestaff($event,s)"  /> </td>
									<td v-else><input  type="radio" v-bind:id="s.pno" name="staff" @click="chosestaff($event,s)"  /> </td>
									<td v-for="m in mechanismPa" v-if="m.mid==s.parentid">{{m.mname}}</td>
									<td>{{s.mid}}</td>
									<td>{{s.mname}}</td>
									<td>{{s.pno}}</td>
									<td>{{s.pname}}</td>
									<td>{{s.psex}}</td>
									<td>{{s.rname}}</td>
									<td>{{s.shealth}}</td>
									<td>{{s.sheight}}</td>
									<td>{{s.splace}}</td>
									<td>{{s.snation}}</td>
									<td>{{s.smarry}}</td>
									<td>{{s.seducation}}</td>
									<td>{{s.sschool}}</td>
									<td>{{s.smajor}}</td>
									<td>{{s.smajorlevel}}</td>
									<td>{{s.pidcard}}</td>
									<td>{{s.presidenceaddress}}</td>
									<td>{{s.pemail}}</td>
									<td>{{s.paddress}}</td>
									<td>{{s.pphone}}</td>
									<td>{{s.ptellphone}}</td>
									<td>{{s.pemail}}</td>
									<td>{{s.speople}}</td>
									<td>{{s.speoplephone}}</td>
									<td>{{s.sinterniship}}</td>
									<td>{{s.sindate}}</td>
									<td>{{s.sbirthday}}</td>
									<td>{{s.sstarttime}}</td>
									<td>{{s.sendtime}}</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
				<div class="row" style="font-size: 17px;box-sizing: border-box;padding-left: 20px; padding-top: 13px;background-color: ghostwhite;">
					合计：<span id="total">2</span>条记录
				</div>
			</div>
			<div id="addstaff">
				<p style="padding: 2px;background-color: #858585;font-weight: bold;color: #D6D6CE;">员工卡片</p>
				<div style="width: 980px;height: 630px;border:1px solid white;margin-left: 10px;background-color: white;">
					<div style="width: 960px;height: 60px;margin-left: 10px;">
						<div style="display: inline-block;width: 200px;height: 60px;font-size: 30px;box-sizing: border-box;padding-top: 5px;">员工卡片</div>
						<div @click="closeadd" class="clo" style="display: inline-block;width: 100px;height: 60px;box-sizing: border-box;float:right;font-size: 50px;text-align: right;">X</div>
						<button @click="addStaffOK" class="btn-success" style="float: right;width: 100px;height: 40px;margin-top: 10px;">保存</button>
					</div>
					<div style="width: 960px;height: 555px;margin-left: 10px;background-color: #D6D6CE;color:#44BDCA;box-sizing: border-box;padding-left: 20px;">
						<p class="ddd" style="padding-top: 10px;">
							<label><span style="color: red;">*</span>员工编号</label><input type="text" v-model="staf.people.pno"  />
							<label><span style="color: red;">*</span>员工姓名</label><input type="text" v-model="staf.people.pname" />
							<label><span style="color: red;">*</span>性别</label><input type="text" v-model="staf.people.psex"  />
						</p>
						<p>
							<label><span style="color: red;">*</span>所在门店</label><input readonly="readonly" type="text" v-for="m in mechanismPa" v-if="demonMech.parentid==m.mid" :value="m.mname"  />
							<label><span style="color: red;">*</span>所在部门</label>
							<input v-if="cc==1" type="text" disabled="disabled" style="width: 50px;" v-model="demonMech.mid" />
							<input v-else disabled="disabled" style="width: 50px;" v-model="staf.mid" />
							
							<input v-if="cc==1" readonly="readonly" type="text" v-model="demonMech.mname"  />
							<input v-else readonly="readonly" type="text" v-model="staf.mname"  />
																									
						</p>
						<p>
							<label>岗位</label><select v-model="staf.jid"><option v-for="j in jobs" :value="j.jid">{{j.jname}}</option></select>
							<label>身体状况</label><input type="text" v-model="staf.shealth"  />
						</p>
						<p>
							<label>身高</label><input type="text" v-model="staf.sheight"  />
							<label>籍贯</label><input type="text" v-model="staf.splace"  />
							<label>民族</label><input type="text" v-model="staf.snation"  />
						</p>
						<p>
							<label>婚姻状况</label><input type="text" v-model="staf.smarry"  />
							<label>学历</label>
							<select v-model="staf.seducation" >
								<option selected="selected" value="博士">博士</option>
								<option value="本科">本科</option>
								<option value="大专">大专</option>
								<option value="高中">高中</option>
							</select>
							<label>毕业学校</label><input type="text" v-model="staf.sschool"  />
						</p>
						<p class="ddd">
							<label>专业</label><select v-model="staf.smajor" >
								<option selected="selected" value="计算机软件">计算机软件</option>
								<option value="网络工程">网络工程</option>
							</select>
							<label>专业资格</label><select v-model="staf.smajorlevel" >
								<option selected="selected" value="初级工程师">中级工程师</option>
								<option value="中级工程师">中级工程师</option>
								<option value="高级工程师">高级工程师</option>
							</select>
							<label><span style="color: red;">*</span>属性</label><select v-model="staf.sfiel" >
								<option selected="selected" value="计考勤计薪">计考勤计薪</option>
								<option value="不计考勤计薪">不计考勤计薪</option>
								<option value="计考勤不计薪">计考勤不计薪</option>
								<option value="不计考勤不计薪">不计考勤不计薪</option>
							</select>
						</p>
						<p>
							<label><span style="color: red;">*</span>身份证号</label><input type="text" v-model="staf.people.pidcard"  />
							<label><span style="color: red;">*</span>户口地址</label><input type="text" v-model="staf.people.presidenceaddress"  />
						</p>
						<p>
							<label><span style="color: red;">*</span>现住地址</label><input  type="text" v-model="staf.people.paddress" />
							<label><span style="color: red;">*</span>联系电话</label><input type="text" v-model="staf.people.pphone"  />
							<label><span style="color: red;">*</span>手机</label><input type="text" v-model="staf.people.ptellphone"  />
						</p>
						<p>
							<label><span style="color: red;">*</span>EMAIL</label><input type="text" v-model="staf.people.pemail"  />
							<label>开户银行</label><input type="text" v-model="staf.people.pbank"  />
							<label>银行账号</label><input type="text" v-model="staf.people.pbanknumber"  />
						</p>
						<p style="padding-top: 20px;">
							<label><span style="color: red;">*</span>紧急联系人</label><input type="text" v-model="staf.speople"  />
							<label>联系电话</label><input type="text" v-model="staf.speoplephone" />
						</p>
						<p>
							<label>入职日期</label><input type="date" v-model="staf.sindate" />
							<label>试用到期</label><input type="date" v-model="staf.sinterniship" />
							<label>出生日期</label><input type="date" v-model="staf.sbirthday" />
							<label>合同开始</label><input type="date" v-model="staf.sstarttime" />
						</p>
						<p>
							<label>合同结束</label><input type="date" v-model="staf.sendtime" />
							<label>卡自编号</label><input type="text" v-model="staf.snonumber" />
							<label>卡内部号</label><input type="text" v-model="staf.sinnumber" />
							<label>推荐人</label><input type="text" v-model="staf.srecommed"/>
						</p>
						<p>
							<label>整单折扣权%</label><input type="text" v-model="staf.salldiscount"/>
							<label>工时折扣权%</label><input type="text" v-model="staf.sworkdiscount"/>
							<label>商品折扣权%</label><input type="text" v-model="staf.sshopdiscount"/>
							<label>减免权</label><input type="text" v-model="staf.sdiscount"/>
						</p>
					</div>
				</div>
			</div>
			<div id="checkstaff">
				<p style="padding: 2px;background-color: #858585;font-weight: bold;color: #D6D6CE;">员工查询</p>
				<div style="width: 880px;height: 450px;border:1px solid white;margin-left: 10px;background-color: white;">
					<div style="width: 860px;height: 50px;margin-left: 10px;">
						<div style="display: inline-block;width: 200px;height: 40px;font-size: 30px;box-sizing: border-box;padding-top: 5px;border-left: 4px solid orange;">员工查询</div>
						<div @click="closeadd" class="clo" style="display: inline-block;width: 100px;height: 40px;box-sizing: border-box;float:right;font-size: 50px;text-align: right;padding: 0px;">X</div>
						<button class="btn-success" style="float: right;width: 100px;height: 40px;margin-top: 5px;">确定</button>
					</div>
					<div style="width: 860px;height: 390px;margin-left: 10px;background-color: #D6D6CE;color:#44BDCA;box-sizing: border-box;padding-left: 20px;">
						<p style="padding-top: 10px;">
							<label><span style="color: red;">*</span>员工编号</label><input />
							<label><span style="color: red;">*</span>员工姓名</label><input />
							<label><span style="color: red;">*</span>性别</label><input />
						</p>
						<p>
							<label><span style="color: red;">*</span>岗位</label><input />
							<label><span style="color: red;">*</span>所在部门</label><input />
						</p>
						<p>
							<label>身体状况</label><input />
							<label>身高</label><input />
							<label>籍贯</label><input />
						</p>
						<p>
							<label>名族</label><input />
							<label>婚姻状况</label><input />
							<label>学历</label><input />
						</p>
						<p>
							<label>毕业学校</label><input />
							<label>专业</label><input />
							<label>专业资格</label><input />
						</p>
						<p>
							<label>生日</label><input />
							<label>学位</label><input />
							<label>编制</label><input />
						</p>
						<p>
							<label>身份证号</label><input />
							<label>入职日期&nbsp;&nbsp;从</label><input />
							<label style="text-align: left;">至</label><input />
						</p>
						<p>
							<label>试用到期&nbsp;&nbsp;从</label><input />
							<label style="text-align: left;">至</label><input />
							<label>属性</label><input />
						</p>
						<p>
							<label>合同开始&nbsp;&nbsp;从</label><input />
							<label style="text-align: left;">至</label><input />
						</p>
					</div>
				</div>
			</div>
			<div id="role">
				<p style="padding: 2px;background-color: #858585;font-weight: bold;color: #D6D6CE;">员工角色</p>
				<div style="width: 430px;height: 550px;border:1px solid white;margin-left: 10px;background-color: white;">
					<div style="width: 410px;height: 50px;margin-left: 10px;">
						<div style="display: inline-block;width: 100px;height: 40px;font-size: 20px;box-sizing: border-box;padding-top: 5px;border-left: 4px solid orange;">员工角色</div>
						<div @click="closeadd" class="clo" style="display: inline-block;width: 50px;height: 40px;box-sizing: border-box;float:right;font-size: 30px;text-align: right;padding: 0px;">X</div>
						<button @click="roleOK" class="btn-success" style="float: right;width: 80px;height: 30px;margin-top: 6px;">保存</button>
					</div>
					<div style="width: 410px;height: 490px;margin-left: 10px;background-color: #D6D6CE;box-sizing: border-box;padding-left: 20px;padding-top: 25px;">
						
						<table class="table table-bordered" style="border: 1px solid white;width: 350px; ">
							<thead>
								<tr>
									<td></td>
									<td>角色名称</td>
									<td>包含</td>
								</tr>
							</thead>
							<tbody>
								<tr v-for="r in role">
									<td>  </td>
									<td>{{r.rname}}</td>
									<td><input type="radio" @click="choserole($event,r)" name="rr" :id="r.rid" /> </td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
			
			<div id="mmm">
				<p style="padding: 2px;background-color: #858585;font-weight: bold;color: #D6D6CE;">部门定义</p>
				<div style="width: 480px;height: 250px;border:1px solid white;margin-left: 10px;background-color: white;">
					<div style="width: 460px;height: 50px;margin-left: 10px;">
						<div style="display: inline-block;width: 200px;height: 40px;font-size: 24px;box-sizing: border-box;padding-top: 5px;border-left: 4px solid orange;">部门定义</div>
						<div @click="closeadd" class="clo" style="display: inline-block;width: 100px;height: 40px;box-sizing: border-box;float:right;font-size: 50px;text-align: right;padding: 0px;"></div>
						<button @click="addmOK" class="btn-success" style="float: right;width: 100px;height: 40px;margin-top: 5px;">确定</button>
					</div>
					<div style="width: 460px;height: 190px;margin-left: 10px;background-color: #D6D6CE;color:#44BDCA;box-sizing: border-box;padding-left: 20px;padding-top: 20px;">
						
						<p class="ddd">
							<label style="width: 150px;">部门编码</label><input readonly="readonly"  type="text" v-model="addMechanism.mid" />
							<input v-if="addMechanism.catalog=='0'" type="checkbox"style="width: 50px;" /><input v-else checked="checked"  type="checkbox" style="width: 50px;" />是否为目录
						</p>
						<p class="ddd">
							<label style="width: 150px;">部门名称</label><input class="mname" style="width: 200px;" type="text" v-model="addMechanism.mname" />
						</p>
						<p>
							<label style="width: 150px;">备注</label><input style="width: 200px;" type="text" />
						</p>
					</div>
				</div>
			</div>
			
			<div id="setting">
				<p style="padding: 2px;background-color: #858585;font-weight: bold;color: #D6D6CE;">字段设置</p>
				<div style="width: 580px;height: 550px;border:1px solid white;margin-left: 10px;background-color: white;">
					<div style="width: 560px;height: 50px;margin-left: 10px;">
						<div style="display: inline-block;width: 100px;height: 40px;font-size: 20px;box-sizing: border-box;padding-top: 5px;border-left: 4px solid orange;">字段设置</div>
						<div @click="closeadd" class="clo" style="display: inline-block;width: 50px;height: 40px;box-sizing: border-box;float:right;font-size: 30px;text-align: right;padding: 0px;">X</div>
						<button class="btn-success" style="float: right;width: 80px;height: 30px;margin-top: 6px;">保存</button>
					</div>
					<div style="width: 560px;height: 490px;margin-left: 10px;background-color: #D6D6CE;box-sizing: border-box;padding-left: 20px;">
						<ul>
							<li><span class="glyphicon glyphicon-leaf" style="color: orange;"></span>全部选择</li>
							<li><span class="glyphicon glyphicon-leaf" style="color: orange;"></span>全部取消</li>
						</ul>
						<table class="table table-bordered" style="border: 1px solid white;width: 500px;">
							<thead>
								<tr>
									<td></td>
									<td>字段</td>
									<td>字段名称</td>
									<td>显示</td>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td>   </td>
									<td>id</td>
									<td>编号</td>
									<td><input type="checkbox" /></td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>

			<script src="js/jquery-1.12.4.js" type="text/javascript" charset="utf-8"></script>
			<script src="js/bootstrap.min.js" type="text/javascript" charset="utf-8"></script>
			<script src="js/vue.js" type="text/javascript" charset="utf-8"></script>
			<script src="js/my.js" type="text/javascript" charset="utf-8"></script>
			<script src="js/jquery.ztree.core.js" type="text/javascript" charset="utf-8"></script>
			<script src="js/jquery.ztree.excheck.js" type="text/javascript" charset="utf-8"></script>
			<script src="js/jquery.ztree.exedit.js" type="text/javascript" charset="utf-8"></script>
			<script type="text/javascript">
				
				function queryTree(){
					//树状结构
					$.ajax({
							type:"get",
							url:data.ip+"staff/queryAllMechanism",
							dateType:"json",
							xhrFields:{
								withCredentials:true
							},
							success:function(response){
								console.log(response);
								$.fn.zTree.init($("#treeDemo"), setting, response);//初始化节点数据
								$.fn.zTree.init($("#treeDemo"), setting, response).expandAll(true);
							}
						});	
						
						var setting = {
							  view: {
							         selectedMulti: true,
							         showIcon:false
							     },
							  check: {
							   enable: false
							  },
							  data: {
								   key: {
								        name: "mname",//树节点名称
								   },
								   simpleData: {
								    enable: true,//是否采用简单数据模式
								        idKey: "mid",//树节点ID名称
								        pIdKey: "parentid",//父节点ID名称
								        rootPId: 1,//根节点ID
								   }
							  },
							  callback:{
							  	onClick:chooseNode,
							  }
						};
							 
						function chooseNode(event, treeId, treeNode) {
						    if (treeNode.mid == "1") {
						       	vm.kk=0;
						        return;
						    }else if(treeNode.parentid=="1"){
						       	vm.kk=0;
						       	queryPeopleByParentid("",treeNode.mid)
						    }else{
						       	vm.kk=parseInt(vm.kk)+1;
						       	vm.demonMech = treeNode;
						       	queryPeopleByMid("",treeNode.mid)
						    }
						    return;
						}
				}
				
				
				function queryMid(){
					$.ajax({
							type:"get",
							url:data.ip+"staff/queryAllMechanism",
							dateType:"json",
							xhrFields:{
								withCredentials:true
							},
							success:function(response){
								let a = parseInt(response[response.length-1].mid);
								vm.addMechanism.mid=a+1;
							}
						});
				}
				
				function queryJob(){
					$.ajax({
						type:"get",
						url:data.ip+"staff/queryAllJob",
						data:{},
						dateType:"json",
						success:function(response){
							vm.jobs=response;
						},error:function(response){
							alert("发生错误"+response);
						}
					});	
				}
				function queryPeopleByMid(pno,mid){
					$.ajax({
						type:"post",
						url:data.ip+"cus/queryPeopleByMid",
						data:{pno:pno,mid:mid},
						dateType:"json",
						success:function(response){
							vm.staffs = response;
							console.log("全部职工")
							console.log(vm.staffs);
							$("#total").text(response.length);
						},error:function(response){
							alert("发生错误"+response);
						}
					});	
				}
				function queryAllStaff(){
					$.ajax({
						type:"get",
						url:data.ip+"staff/queryAllStaff",
						data:{},
						dateType:"json",
						success:function(response){
							let pno = response[response.length-1].pno;
							let no = "dzw";
							//alert(no+"..."+pno+"..."+pno.lastIndexOf("0")+"..."+pno.substring(5,pno.length));
							if(pno.lastIndexOf("0")=="4"){
								let num = parseInt(pno.substring(pno.lastIndexOf("0")+1,pno.length));
								num = num+1;
								no = no+"00"+num;
							}else if(pno.lastIndexOf("0")=="3"){
								let num = parseInt(pno.substring(pno.lastIndexOf("0")+1,pno.length));
								num = num+1;
								no = no+"0"+num;
							}else if(pno.lastIndexOf("0")=="2"){
								let num = parseInt(pno.substring(pno.lastIndexOf("0")+1,pno.length));
								num = num+1;
								no = no+num;
							}
							vm.staf.pno=no;
							vm.staf.people.pno=no;
						},error:function(response){
							alert("发生错误"+response);
						}
					});	
				}
				function queryPeopleByParentid(pno,parentid){
					$.ajax({
						type:"get",
						url:data.ip+"staff/queryPeopleByParentid",
						data:{pno:pno,parentid:parentid},
						dateType:"json",
						success:function(response){
							vm.staffs = response;
							console.log("全部职工")
							console.log(vm.staffs);
							$("#total").text(response.length);
						},error:function(response){
							alert("发生错误"+response);
						}
					});	
				}
				function queryAllRole(){
					$.ajax({
						type:"get",
						url:data.ip+"staff/queryAllRole",
						data:{},
						dateType:"json",
						success:function(response){
							vm.role = response;
						},error:function(response){
							alert("发生错误"+response);
						}
					});	
				}
				function queryMechanByparentid(parentid){
					$.ajax({
						type:"get",
						url:data.ip+"staff/queryMechanByparentid",
						data:{parentid:parentid},
						dateType:"json",
						success:function(response){
							vm.mechanismPa = response;
						},error:function(response){
							alert("发生错误"+response);
						}
					});	
				}
				
				var vm = new Vue({
					el:"#ctx",
					data(){
						return {
							kk:"0",
							roles:[],//树状结构节点
							staffs:[],//根据机构编号查询到的所有职工
							mechanismPa:[],//机构
							demon:{pno:"",mid:"",rid:"",people:{ptid:1,pno:""}},//选中的职工对象
							demonMech:{},//选中的部门
							staf:{pno:"",mid:"",rid:2,people:{ptid:1,pno:"",rid:2,spassword:"88888"},salt:"951753"},//新增的员工
							jobs:[],//所有岗位
							addMechanism:{mid:"",parentid:"",catalog:"0"},//添加部门
							role:[],//所有角色
							cc:"0",
							ro:{rid:""},//选中的角色
							
						}
					},
					methods:{
						roleOK:function(){
							if(confirm("是否确定更改员工角色")){
								vm.demon.rid = vm.ro.rid;
								console.log(vm.demon)
								$.ajax({
										url:data.ip+"staff/updatePeoRole",
										data:JSON.stringify(vm.demon),
										type:"put",
										dataType:"json",
										contentType:"application/json;charset=utf-8",
										success:function(result){
											if(result=="1"){
												alert("修改成功");
												queryPeopleByParentid("",1);
												$("#role").hide();
											}
										},error:function(result){
											alert("发生错误");
										}
									});
							}
						},
						choserole:function(e,r){
							let checked = e.target.checked;
							if(checked){
								vm.ro=r;
							}
						},
						check:function(){
							//查询
							let pno = $("#querybox").val();
							if(vm.demonMech.parentid=1){
								queryPeopleByParentid(pno,2);
							}else{
								queryPeopleByMid(pno,vm.demonMech.mid);
							}
							
						},
						addmOK:function(){
							if($("#mmm input[type=checkbox]")[0].checked){
								vm.addMechanism.catalog="1";
							}else{
								vm.addMechanism.catalog="0";
							}
							if($("#mmm .mname").val()==""){
								alert("请填写部门名称！")
							}else{
								if(vm.kk=="9"){
									$.ajax({
										url:data.ip+"staff/addMech",
										data:JSON.stringify(vm.addMechanism),
										type:"post",
										dataType:"json",
										contentType:"application/json;charset=utf-8",
										success:function(result){
											if(result=="1"){
												alert("添加成功");
												queryTree();
												$("#mmm").hide();
											}
										},error:function(result){
											alert("发生错误");
										}
									});
								}else if(vm.kk=="10"){
									$.ajax({
										url:data.ip+"staff/addMech",
										data:JSON.stringify(vm.addMechanism),
										type:"post",
										dataType:"json",
										contentType:"application/json;charset=utf-8",
										success:function(result){
											if(result=="1"){
												alert("添加成功");
												$("#mmm").hide();
												queryTree();
											}
										},error:function(result){
											alert("发生错误");
										}
									});
								}else if(vm.kk=="11"){
									$.ajax({
										url:data.ip+"staff/upMech",
										data:JSON.stringify(vm.addMechanism),
										type:"put",
										dataType:"json",
										contentType:"application/json;charset=utf-8",
										success:function(result){
											if(result=="1"){
												alert("修改成功");
												$("#mmm").hide();
												queryTree();
											}
										},error:function(result){
											alert("发生错误");
										}
									});
								}
							}
						},
						addsamelevel:function(){
							vm.kk="9";
							queryMid();
							vm.addMechanism.parentid = vm.demonMech.parentid;
							$("#mmm").show();
						},
						addsonlevel:function(){
							vm.kk="10";
							queryMid();
							vm.addMechanism.parentid = vm.demonMech.mid;
							$("#mmm").show();
						},
						upmechanism:function(){
							vm.kk="11";
							vm.addMechanism = vm.demonMech;
							$("#mmm").show();
						},
						delmechanism:function(){
							let mid = vm.demonMech.mid;
							if(confirm("是否确认删除？")){
								$.ajax({
										url:data.ip+"staff/deleMech",
										data:{mid:mid},
										type:"post",
										dataType:"json",
										success:function(result){
											if(result=="1"){
												alert("删除成功");
												queryTree();
											}
										},error:function(result){
											alert("发生错误");
										}
									});
							}
						},
						nonepwd:function(){
							//置空密码
							if(confirm("是否确认置空")){
								$.ajax({
										url:data.ip+"staff/updateStaffPwd",
										data:JSON.stringify(vm.demon),
										type:"post",
										dataType:"json",
										contentType:"application/json;charset=utf-8",
										success:function(result){
											if(result=="1"){
												alert("置空成功");
												queryPeopleByMid("",vm.demonMech.mid);
												
											}
										},error:function(result){
											alert("发生错误");
										}
									});
							}
						},
						chosestaff:function(e,c){
							//客户单选框
							let checkeds = e.target.checked;
							if(checkeds){
								let cno = $(e.target).attr("id");
								$(e.target).parent().parent().css("background-color","#C9E2B3").siblings().css("background-color","white");
								
								vm.demon.people.pno=c.pno;
								vm.demon.people.pname=c.pname;
								vm.demon.people.psex=c.psex;
								vm.demon.people.pidcard=c.pidcard;
								vm.demon.people.paddress=c.paddress;
								vm.demon.people.pphone=c.pphone;
								vm.demon.people.ptellphone=c.ptellphone;
								vm.demon.people.pemail=c.pemail;
								vm.demon.people.spassword=c.spassword;
								vm.demon.people.salt=c.salt;
								vm.demon.people.pbank=c.pbank;
								vm.demon.people.pbanknumber=c.pbanknumber;
								vm.demon.people.presidenceaddress=c.presidenceaddress;
								vm.demon.people.ptid=c.ptid;
								vm.demon.people.img=c.img;
								vm.demon.people.rid=c.rid;
								vm.demon.people.dimission=c.dimission;
								vm.demon.people.dcause=c.dcause;
								
								
								
								vm.demon.sid=c.sid;
								vm.demon.pno=c.pno;
								vm.demon.mid=c.mid;
								vm.demon.mname=c.mname;
								vm.demon.jid = c.jid;
								vm.demon.rid = c.rid;
								vm.demon.shealth = c.shealth;
								vm.demon.splace = c.splace;
								vm.demon.snation = c.snation;
								vm.demon.smarry = c.smarry;
								vm.demon.seducation = c.seducation;
								vm.demon.sschool = c.sschool;
								vm.demon.smajor = c.smajor;
								vm.demon.smajorlevel = c.smajorlevel;
								vm.demon.sfiel = c.sfiel;
								vm.demon.speople = c.speople;
								vm.demon.speoplephone = c.speoplephone;
								vm.demon.sindate = c.sindate;
								vm.demon.sinterniship = c.sinterniship;
								vm.demon.sbirthday = c.sbirthday;
								vm.demon.sstarttime = c.sstarttime;
								vm.demon.sendtime = c.sendtime;
								vm.demon.srecommed = c.srecommed;
								vm.demon.snonumber = c.snonumber;
								vm.demon.sinnumber = c.sinnumber;
								vm.demon.salldiscount = c.salldiscount;
								vm.demon.sworkdiscount = c.sworkdiscount;
								vm.demon.sshopdiscount = c.sshopdiscount;
								vm.demon.sdiscount = c.sdiscount;
								
								console.log(vm.demon);
								
							}else{
								$(e.target).parent().parent().css("background-color","white");
							}
							
						},
						delStaff:function(){
							//删除选中职工
							
							if(vm.demon==undefined){
								alert("请选中需要删除的职工");
								return;
							}
							
								if(confirm("是否确认删除此职工?")){
									$.ajax({
										url:data.ip+"staff/deleteStaff",
										data:JSON.stringify(vm.demon),
										type:"post",
										dataType:"json",
										contentType:"application/json;charset=utf-8",
										success:function(result){
											if(result=="1"){
												alert("删除成功");
												queryPeopleByParentid("",2);
											}
										},error:function(result){
											alert("发生错误");
										}
									});
								}
							
						},
						upStaff:function(){
							vm.cc="2";
							//修改职工
							vm.kk="6";
							if(vm.demon==undefined){
								alert("请选中需要修改的职工");
								return;
							}else{
								vm.staf = vm.demon;
								console.log(vm.staf)
								$("#addstaff").show();
							}
						},
						addStaffOK:function(){
							//确定修改/新增职工
							
							$("#addstaff .ddd input").each(function(){
								if($(this).val()==""){
									alert("请填写重要信息")
									return false;
								}
							});
							$("#addstaff .ddd select").each(function(){
								if($(this).val()==""){
									alert("请填写重要信息")
									return false;
								}
							});
							if(vm.kk=="5"){
								vm.staf.mid = vm.demonMech.mid;
								vm.staf.people.spassword="88888888";
								$.ajax({
										url:data.ip+"staff/addStaff",
										data:JSON.stringify(vm.staf),
										type:"post",
										dataType:"json",
										contentType:"application/json;charset=utf-8",
										success:function(result){
											if(result=="1"){
												alert("添加成功");
												queryPeopleByMid("",vm.demonMech.mid);
												vm.staf={pno:"",mid:"",rid:2,people:{ptid:1,pno:"",rid:2,spassword:"88888"},salt:"951753"};
												queryAllStaff();
											}
										},error:function(result){
											alert("发生错误");
										}
									});
							}else if(vm.kk=="6"){
								console.log(vm.staf);
								$.ajax({
										url:data.ip+"staff/updateStaff",
										data:JSON.stringify(vm.staf),
										type:"put",
										dataType:"json",
										contentType:"application/json;charset=utf-8",
										success:function(result){
											if(result=="1"){
												alert("修改成功");
												if(vm.demonMech.parentid==1){
													queryPeopleByParentid("",vm.demonMech.mid);
												}else{
													queryPeopleByMid("",vm.demonMech.mid);
												}
											}
										},error:function(result){
											alert("发生错误");
										}
									});
							}
						},
						addstaff:function(){
							vm.cc="1";
							//新增职工
							if(vm.kk=="0"){
								alert("请选择要增加员工的部门");
							}else{
								queryAllStaff();
								console.log(vm.demonMech)
								vm.kk="5";
								$("#addstaff").show();
							}
							
						},
						closeadd:function(){
							$("#addstaff").hide();
							$("#checkstaff").hide();
							$("#role").hide();
							$("#setting").hide();
							$("#mmm").hide();
						},
						checkstaff:function(){
							$("#checkstaff").show();
						},
						staffrole:function(){
							if(vm.demon.pno==""){
								alert("请选中员工");
							}else{
								queryAllRole();
								$("#role").show();
							}
						},
						setting:function(){
							$("#setting").show();
						}
					},
					created:function(){
						queryMechanByparentid(1);
						queryPeopleByParentid("",2);
						queryJob();
						queryTree();
						
					}
					
				});
				
			
			$(function(){
				
						
//				$.ajax({
//					type:"get",
//					url:data.ip+"per/findRoles",
//					dateType:"json",
//					xhrFields:{
//						withCredentials:true
//					},
//					success:function(response){
//						vm.roles=response;
//					}
//				});
			});
			
		</script>
	</body>

</html>